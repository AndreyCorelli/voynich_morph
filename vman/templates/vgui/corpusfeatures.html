{% extends "base.html" %}

{% block content %}
<div>
    <button onclick="window.manager.loadCorpus();">&nbsp;LOAD CORPUS&nbsp;</button>
    <table>
        <tr>
            <td>
                <div id="corpus_a">
                </div>
            </td>
            <td>
                <div id="corpus_b">
                </div>
            </td>
        </tr>
    </table>
</div>
{% endblock %}

{% block js_extra %}
<script type="text/javascript">
    $(function() {
        window.manager = new CorpusComparer();
    });

    function CorpusComparer() {
        this.corpusPaths = {};
        this.setupCorpusCombo();
    }

    CorpusComparer.prototype.loadCorpus = function() {

    }

    CorpusComparer.prototype.setupCorpusCombo = function() {
        var that = this;
        $.ajax({
            type: 'POST',
            data: {'list': true},
            success: function(data) {
                that.corpusPaths = data;
                that.addComboboxOptions('corpus_a');
                that.addComboboxOptions('corpus_b');
            },
            dataType: 'json'
        });
    }

    CorpusComparer.prototype.addComboboxOptions = function(selector) {
        var markup = 'LANGUAGE: <select name="languageSelector" onchange="window.manager.languageSelected(\'' +
            selector + '\')">\n';
        for (var lang in this.corpusPaths.path_by_language) {
            var langName = this.corpusPaths.language_title[lang];
            markup += '  <option value="' + lang + '">' + langName + '</option>\n';
        }
        markup += '</select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
        markup += 'TEXT: <select name="textSelector"></select>';

        $('#' + selector).html(markup);
        $('#' + selector + ' select[name="languageSelector"]').get()[0].dispatchEvent(new Event('change'));
    }

    CorpusComparer.prototype.languageSelected = function(selector) {
        var lang = $('#' + selector + ' select[name="languageSelector"]').val();
        var markup = '<select name="textSelector">\n';

        var paths = this.corpusPaths.discrete_paths[lang];
        for (var i = 0; i < paths.length; i++) {
            markup += '  <option value="' + paths[i][1] + '">' + paths[i][0] + '</option>\n';
        }
        markup += '</select>';
        $('#' + selector + ' select[name="textSelector"]').replaceWith(markup);
    }
</script>
{% endblock %}